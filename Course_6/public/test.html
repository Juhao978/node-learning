<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬6è¯¾ï¼šJWT è®¤è¯æµ‹è¯•</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #e4e4e7;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { text-align: center; color: #fff; margin-bottom: 10px; }
    .subtitle { text-align: center; color: rgba(255,255,255,0.8); margin-bottom: 30px; }
    
    .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
    
    .panel {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
    }
    .panel h2 { color: #a78bfa; margin-bottom: 15px; }
    
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; }
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      background: rgba(0,0,0,0.3);
      color: white;
    }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .btn-primary { background: #a78bfa; color: white; }
    .btn-success { background: #22c55e; color: white; }
    .btn-warning { background: #f59e0b; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    
    #response {
      background: #0f172a;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 13px;
      min-height: 200px;
      max-height: 400px;
      overflow: auto;
      white-space: pre-wrap;
    }
    
    .token-display {
      background: rgba(34,197,94,0.2);
      border: 1px solid rgba(34,197,94,0.5);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      word-break: break-all;
    }
    .token-display.no-token {
      background: rgba(239,68,68,0.2);
      border-color: rgba(239,68,68,0.5);
    }
    
    .jwt-structure {
      display: flex;
      gap: 5px;
      margin-top: 10px;
      font-family: monospace;
      font-size: 12px;
    }
    .jwt-header { color: #ef4444; }
    .jwt-payload { color: #a78bfa; }
    .jwt-signature { color: #22c55e; }
    
    .status-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding: 10px 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .status-dot.online { background: #22c55e; }
    .status-dot.offline { background: #ef4444; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ç¬¬6è¯¾ï¼šç”¨æˆ·è®¤è¯ï¼ˆJWTï¼‰</h1>
    <p class="subtitle">ä½“éªŒå®Œæ•´çš„è®¤è¯æµç¨‹ï¼šæ³¨å†Œ â†’ ç™»å½• â†’ è®¿é—®ä¿æŠ¤æ¥å£</p>
    
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">æœªç™»å½•</span>
      <button class="btn-danger" onclick="logout()" style="margin-left: auto; margin-bottom: 0;">é€€å‡ºç™»å½•</button>
    </div>
    
    <div class="token-display no-token" id="tokenDisplay">
      <strong>å½“å‰ Tokenï¼š</strong><br>
      <span id="currentToken">æœªç™»å½•</span>
    </div>
    
    <div class="layout">
      <div>
        <div class="panel">
          <h2>ğŸ“ æ³¨å†Œ</h2>
          <div class="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="regUsername" placeholder="username">
          </div>
          <div class="form-group">
            <label>é‚®ç®±</label>
            <input type="email" id="regEmail" placeholder="user@example.com">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="regPassword" placeholder="password">
          </div>
          <button class="btn-primary" onclick="register()">æ³¨å†Œ</button>
        </div>
        
        <div class="panel" style="margin-top: 20px;">
          <h2>ğŸ”‘ ç™»å½•</h2>
          <div class="form-group">
            <label>é‚®ç®±</label>
            <input type="email" id="loginEmail" placeholder="user@example.com">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="loginPassword" placeholder="password">
          </div>
          <button class="btn-success" onclick="login()">ç™»å½•</button>
        </div>
        
        <div class="panel" style="margin-top: 20px;">
          <h2>ğŸ”’ å—ä¿æŠ¤æ¥å£æµ‹è¯•</h2>
          <button class="btn-primary" onclick="getMe()">è·å–å½“å‰ç”¨æˆ· (GET /me)</button>
          <button class="btn-warning" onclick="getUsers()">è·å–æ‰€æœ‰ç”¨æˆ· (admin)</button>
          <p style="margin-top: 10px; font-size: 13px; color: rgba(255,255,255,0.6);">
            ğŸ’¡ æœªç™»å½•æ—¶è®¿é—®ä¼šè¿”å› 401 é”™è¯¯
          </p>
        </div>
      </div>
      
      <div class="panel">
        <h2>ğŸ“¤ å“åº”ç»“æœ</h2>
        <div id="response">
JWT è®¤è¯æµç¨‹ï¼š

1. ç”¨æˆ·æ³¨å†Œæˆ–ç™»å½•
2. æœåŠ¡å™¨éªŒè¯å‡­æ®
3. æœåŠ¡å™¨ç”Ÿæˆ JWT Token è¿”å›ç»™å®¢æˆ·ç«¯
4. å®¢æˆ·ç«¯ä¿å­˜ Tokenï¼ˆé€šå¸¸åœ¨ localStorageï¼‰
5. åç»­è¯·æ±‚åœ¨ Header ä¸­æºå¸¦ Token
   Authorization: Bearer eyJhbGc...

JWT ç»“æ„ï¼š
header.payload.signature

â€¢ Header: ç®—æ³•å’Œç±»å‹
â€¢ Payload: ç”¨æˆ·æ•°æ®
â€¢ Signature: ç­¾åéªŒè¯</div>
      </div>
    </div>
  </div>
  
  <script>
    const API = 'http://localhost:3000/api';
    let token = localStorage.getItem('token');
    
    updateStatus();
    
    function show(data) {
      document.getElementById('response').textContent = JSON.stringify(data, null, 2);
    }
    
    function updateStatus() {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');
      const display = document.getElementById('tokenDisplay');
      const tokenSpan = document.getElementById('currentToken');
      
      if (token) {
        dot.className = 'status-dot online';
        text.textContent = 'å·²ç™»å½•';
        display.className = 'token-display';
        tokenSpan.textContent = token;
      } else {
        dot.className = 'status-dot offline';
        text.textContent = 'æœªç™»å½•';
        display.className = 'token-display no-token';
        tokenSpan.textContent = 'æœªç™»å½•';
      }
    }
    
    function saveToken(newToken) {
      token = newToken;
      localStorage.setItem('token', token);
      updateStatus();
    }
    
    function logout() {
      token = null;
      localStorage.removeItem('token');
      updateStatus();
      show({ message: 'å·²é€€å‡ºç™»å½•' });
    }
    
    async function register() {
      const data = {
        username: document.getElementById('regUsername').value,
        email: document.getElementById('regEmail').value,
        password: document.getElementById('regPassword').value
      };
      
      try {
        const res = await fetch(`${API}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        show(result);
        
        if (res.ok && result.token) {
          saveToken(result.token);
        }
      } catch (e) {
        show({ error: e.message });
      }
    }
    
    async function login() {
      const data = {
        email: document.getElementById('loginEmail').value,
        password: document.getElementById('loginPassword').value
      };
      
      try {
        const res = await fetch(`${API}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        show(result);
        
        if (res.ok && result.token) {
          saveToken(result.token);
        }
      } catch (e) {
        show({ error: e.message });
      }
    }
    
    async function getMe() {
      try {
        const res = await fetch(`${API}/auth/me`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        show(await res.json());
      } catch (e) {
        show({ error: e.message });
      }
    }
    
    async function getUsers() {
      try {
        const res = await fetch(`${API}/users`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        show(await res.json());
      } catch (e) {
        show({ error: e.message });
      }
    }
  </script>
</body>
</html>


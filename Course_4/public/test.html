<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬4è¯¾ï¼šæ•°æ®éªŒè¯æµ‹è¯•</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #2d1f3d 0%, #1a1a2e 100%);
      min-height: 100vh;
      color: #e4e4e7;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { text-align: center; color: #f472b6; margin-bottom: 10px; }
    .subtitle { text-align: center; color: #94a3b8; margin-bottom: 30px; }
    
    .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
    
    .panel {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
    }
    .panel h2 { color: #f472b6; margin-bottom: 15px; }
    
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; color: #94a3b8; }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      background: rgba(0,0,0,0.3);
      color: white;
    }
    .form-group small { color: #94a3b8; font-size: 12px; }
    
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover { transform: translateY(-2px); }
    .btn-primary { background: #f472b6; color: white; }
    .btn-success { background: #22c55e; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-warning { background: #f59e0b; color: white; }
    
    #response {
      background: #0f172a;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 13px;
      min-height: 300px;
      max-height: 500px;
      overflow: auto;
      white-space: pre-wrap;
    }
    
    .error { color: #ef4444; }
    .success { color: #22c55e; }
    
    .validation-rules {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 13px;
    }
    .validation-rules h3 { color: #f472b6; margin-bottom: 10px; }
    .validation-rules li { margin-bottom: 5px; color: #94a3b8; }
    .validation-rules code {
      background: rgba(244,114,182,0.2);
      padding: 2px 6px;
      border-radius: 4px;
    }
    
    .test-case {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .test-case h4 { color: #94a3b8; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>âœ… ç¬¬4è¯¾ï¼šæ•°æ®éªŒè¯ & é”™è¯¯å¤„ç†</h1>
    <p class="subtitle">ä½¿ç”¨ Joi è¿›è¡Œæ•°æ®éªŒè¯ï¼Œä½“éªŒå„ç§é”™è¯¯åœºæ™¯</p>
    
    <div class="layout">
      <!-- å·¦ä¾§ï¼šæµ‹è¯•è¡¨å• -->
      <div>
        <div class="panel">
          <h2>ğŸ“ åˆ›å»ºç”¨æˆ·æµ‹è¯•</h2>
          
          <div class="validation-rules">
            <h3>éªŒè¯è§„åˆ™ï¼š</h3>
            <ul>
              <li><code>name</code>ï¼šå¿…å¡«ï¼Œ2-50ä¸ªå­—ç¬¦</li>
              <li><code>email</code>ï¼šå¿…å¡«ï¼Œæœ‰æ•ˆé‚®ç®±æ ¼å¼</li>
              <li><code>age</code>ï¼šå¯é€‰ï¼Œ1-150çš„æ•´æ•°</li>
              <li><code>role</code>ï¼šå¯é€‰ï¼Œadmin/user/guest</li>
              <li><code>password</code>ï¼šå¿…å¡«ï¼Œ6-30å­—ç¬¦ï¼Œå«å¤§å°å†™å’Œæ•°å­—</li>
            </ul>
          </div>
          
          <div class="form-group">
            <label>å§“å *</label>
            <input type="text" id="name" placeholder="è‡³å°‘2ä¸ªå­—ç¬¦">
          </div>
          
          <div class="form-group">
            <label>é‚®ç®± *</label>
            <input type="email" id="email" placeholder="valid@email.com">
          </div>
          
          <div class="form-group">
            <label>å¹´é¾„</label>
            <input type="number" id="age" placeholder="1-150">
          </div>
          
          <div class="form-group">
            <label>è§’è‰²</label>
            <select id="role">
              <option value="user">user</option>
              <option value="admin">admin</option>
              <option value="guest">guest</option>
              <option value="invalid">invalidï¼ˆæµ‹è¯•é”™è¯¯ï¼‰</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>å¯†ç  *</label>
            <input type="text" id="password" placeholder="å«å¤§å°å†™å­—æ¯å’Œæ•°å­—">
            <small>å¿…é¡»åŒ…å«å¤§å†™ã€å°å†™å’Œæ•°å­—</small>
          </div>
          
          <button class="btn-primary" onclick="createUser()">åˆ›å»ºç”¨æˆ·</button>
          <button class="btn-success" onclick="fillValid()">å¡«å…¥æœ‰æ•ˆæ•°æ®</button>
          <button class="btn-warning" onclick="fillInvalid()">å¡«å…¥æ— æ•ˆæ•°æ®</button>
        </div>
        
        <div class="panel" style="margin-top: 20px;">
          <h2>ğŸ§ª é”™è¯¯åœºæ™¯æµ‹è¯•</h2>
          
          <div class="test-case">
            <h4>404 é”™è¯¯</h4>
            <button class="btn-danger" onclick="test404()">è®¿é—®ä¸å­˜åœ¨çš„æ¥å£</button>
            <button class="btn-danger" onclick="testNotFoundUser()">è·å–ä¸å­˜åœ¨çš„ç”¨æˆ·</button>
          </div>
          
          <div class="test-case">
            <h4>éªŒè¯é”™è¯¯ (400)</h4>
            <button class="btn-warning" onclick="testEmptyBody()">ç©ºè¯·æ±‚ä½“</button>
            <button class="btn-warning" onclick="testInvalidEmail()">æ— æ•ˆé‚®ç®±</button>
          </div>
          
          <div class="test-case">
            <h4>æœåŠ¡å™¨é”™è¯¯ (500)</h4>
            <button class="btn-danger" onclick="testServerError()">è§¦å‘æœåŠ¡å™¨é”™è¯¯</button>
          </div>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šå“åº”ç»“æœ -->
      <div>
        <div class="panel">
          <h2>ğŸ“¤ å“åº”ç»“æœ</h2>
          <div id="response">ç‚¹å‡»æŒ‰é’®æµ‹è¯•éªŒè¯åŠŸèƒ½...

ğŸ’¡ æç¤ºï¼š
1. å…ˆç‚¹å‡»"å¡«å…¥æ— æ•ˆæ•°æ®"ï¼Œå†ç‚¹"åˆ›å»ºç”¨æˆ·"æŸ¥çœ‹éªŒè¯é”™è¯¯
2. ç‚¹å‡»"å¡«å…¥æœ‰æ•ˆæ•°æ®"æµ‹è¯•æˆåŠŸåˆ›å»º
3. å°è¯•å„ç§é”™è¯¯åœºæ™¯</div>
        </div>
        
        <div class="panel" style="margin-top: 20px;">
          <h2>ğŸ“š å‰ç«¯ç±»æ¯”</h2>
          <div style="font-size: 14px; color: #94a3b8; line-height: 1.8;">
            <p><strong>Joi éªŒè¯ â‰ˆ ElementUI è¡¨å•éªŒè¯</strong></p>
            <p style="margin-top: 10px;">ElementUI:</p>
            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; overflow-x: auto;">
rules: {
  name: [
    { required: true, message: 'è¯·è¾“å…¥å§“å' },
    { min: 2, max: 50, message: 'é•¿åº¦2-50' }
  ],
  email: [
    { type: 'email', message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®' }
  ]
}</pre>
            <p style="margin-top: 10px;">Joi:</p>
            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; overflow-x: auto;">
Joi.object({
  name: Joi.string().min(2).max(50).required(),
  email: Joi.string().email().required()
})</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    const API = 'http://localhost:3000/api';
    
    function show(data, isError = false) {
      const el = document.getElementById('response');
      const text = JSON.stringify(data, null, 2);
      el.innerHTML = `<span class="${isError ? 'error' : 'success'}">${text}</span>`;
    }
    
    function fillValid() {
      document.getElementById('name').value = 'å¼ ä¸‰';
      document.getElementById('email').value = 'zhangsan@test.com';
      document.getElementById('age').value = '25';
      document.getElementById('role').value = 'user';
      document.getElementById('password').value = 'Password123';
    }
    
    function fillInvalid() {
      document.getElementById('name').value = 'A';  // å¤ªçŸ­
      document.getElementById('email').value = 'invalid-email';  // æ ¼å¼é”™è¯¯
      document.getElementById('age').value = '200';  // è¶…å‡ºèŒƒå›´
      document.getElementById('role').value = 'invalid';  // æ— æ•ˆæšä¸¾
      document.getElementById('password').value = '123';  // å¤ªç®€å•
    }
    
    async function createUser() {
      const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        age: parseInt(document.getElementById('age').value) || undefined,
        role: document.getElementById('role').value,
        password: document.getElementById('password').value
      };
      
      try {
        const res = await fetch(`${API}/users`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        show(result, !res.ok);
      } catch (e) {
        show({ error: e.message }, true);
      }
    }
    
    async function test404() {
      const res = await fetch(`${API}/not-exist`);
      show(await res.json(), true);
    }
    
    async function testNotFoundUser() {
      const res = await fetch(`${API}/users/99999`);
      show(await res.json(), true);
    }
    
    async function testEmptyBody() {
      const res = await fetch(`${API}/users`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({})
      });
      show(await res.json(), true);
    }
    
    async function testInvalidEmail() {
      const res = await fetch(`${API}/users`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: 'æµ‹è¯•', email: 'not-an-email', password: 'Test123' })
      });
      show(await res.json(), true);
    }
    
    async function testServerError() {
      const res = await fetch(`${API}/error-test`);
      show(await res.json(), true);
    }
  </script>
</body>
</html>


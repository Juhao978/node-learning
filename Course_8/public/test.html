<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬8è¯¾ï¼šåšå®¢ API æµ‹è¯•</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #e4e4e7;
    }
    
    .header {
      background: rgba(0,0,0,0.3);
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .header h1 { color: #60a5fa; margin-bottom: 5px; }
    .header p { color: #94a3b8; }
    
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    .status-bar {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; }
    .status-dot.online { background: #22c55e; }
    .status-dot.offline { background: #ef4444; }
    .user-info { flex: 1; }
    .user-info strong { color: #60a5fa; }
    
    .layout { display: grid; grid-template-columns: 300px 1fr 400px; gap: 20px; }
    @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } }
    
    .panel {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
    }
    .panel h2 { color: #60a5fa; margin-bottom: 15px; font-size: 1rem; }
    
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; margin-bottom: 5px; color: #94a3b8; font-size: 13px; }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      background: rgba(0,0,0,0.3);
      color: white;
      font-size: 14px;
    }
    .form-group textarea { min-height: 100px; resize: vertical; }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    button:hover { transform: translateY(-2px); }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-success { background: #22c55e; color: white; }
    .btn-warning { background: #f59e0b; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-secondary { background: #4b5563; color: white; }
    
    .article-card {
      background: rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .article-card:hover { background: rgba(0,0,0,0.4); }
    .article-card h3 { color: #60a5fa; margin-bottom: 5px; }
    .article-card p { color: #94a3b8; font-size: 13px; }
    .article-card .meta { font-size: 12px; color: #6b7280; margin-top: 10px; }
    
    #response {
      background: #0f172a;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      max-height: 600px;
      overflow: auto;
      white-space: pre-wrap;
    }
    
    .tabs { display: flex; gap: 5px; margin-bottom: 15px; }
    .tab {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: #94a3b8;
      margin: 0;
    }
    .tab.active { background: #3b82f6; border-color: #3b82f6; color: white; }
    
    .comment-input {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .comment-input input { flex: 1; }
    
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      margin-left: 5px;
    }
    .badge-draft { background: #f59e0b; }
    .badge-published { background: #22c55e; }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ‰ ç¬¬8è¯¾ï¼šåšå®¢ API é¡¹ç›®å®æˆ˜</h1>
    <p>æ•´åˆäº†å‰é¢æ‰€å­¦çš„æ‰€æœ‰çŸ¥è¯† - æ­å–œä½ å®Œæˆ Node.js å…¥é—¨è¯¾ç¨‹ï¼</p>
  </div>
  
  <div class="container">
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <div class="user-info">
        <span id="statusText">æœªç™»å½•</span>
        <strong id="userName"></strong>
      </div>
      <button class="btn-danger" onclick="logout()">é€€å‡ºç™»å½•</button>
    </div>
    
    <div class="layout">
      <!-- å·¦ä¾§ï¼šè®¤è¯ -->
      <div>
        <div class="panel">
          <div class="tabs">
            <button class="tab active" onclick="switchAuthTab('login')">ç™»å½•</button>
            <button class="tab" onclick="switchAuthTab('register')">æ³¨å†Œ</button>
          </div>
          
          <div id="loginForm">
            <div class="form-group">
              <label>é‚®ç®±</label>
              <input type="email" id="loginEmail" placeholder="user@example.com">
            </div>
            <div class="form-group">
              <label>å¯†ç </label>
              <input type="password" id="loginPassword" placeholder="password">
            </div>
            <button class="btn-primary" onclick="login()">ç™»å½•</button>
          </div>
          
          <div id="registerForm" style="display: none;">
            <div class="form-group">
              <label>ç”¨æˆ·å</label>
              <input type="text" id="regUsername" placeholder="username">
            </div>
            <div class="form-group">
              <label>é‚®ç®±</label>
              <input type="email" id="regEmail" placeholder="user@example.com">
            </div>
            <div class="form-group">
              <label>å¯†ç </label>
              <input type="password" id="regPassword" placeholder="password">
            </div>
            <button class="btn-success" onclick="register()">æ³¨å†Œ</button>
          </div>
        </div>
        
        <div class="panel" style="margin-top: 20px;">
          <h2>ğŸ“ å‘å¸ƒæ–‡ç« </h2>
          <div class="form-group">
            <label>æ ‡é¢˜</label>
            <input type="text" id="articleTitle" placeholder="æ–‡ç« æ ‡é¢˜">
          </div>
          <div class="form-group">
            <label>å†…å®¹</label>
            <textarea id="articleContent" placeholder="æ–‡ç« å†…å®¹..."></textarea>
          </div>
          <div class="form-group">
            <label>çŠ¶æ€</label>
            <select id="articleStatus">
              <option value="draft">è‰ç¨¿</option>
              <option value="published">å‘å¸ƒ</option>
            </select>
          </div>
          <button class="btn-primary" onclick="createArticle()">å‘å¸ƒæ–‡ç« </button>
        </div>
      </div>
      
      <!-- ä¸­é—´ï¼šæ–‡ç« åˆ—è¡¨ -->
      <div>
        <div class="panel">
          <h2>ğŸ“š æ–‡ç« åˆ—è¡¨</h2>
          <div style="margin-bottom: 15px;">
            <button class="btn-secondary" onclick="loadArticles()">åˆ·æ–°</button>
            <button class="btn-warning" onclick="loadMyArticles()">æˆ‘çš„æ–‡ç« </button>
          </div>
          <div id="articleList">åŠ è½½ä¸­...</div>
        </div>
        
        <div class="panel" style="margin-top: 20px;" id="articleDetail" style="display: none;">
          <h2>ğŸ“„ æ–‡ç« è¯¦æƒ…</h2>
          <div id="detailContent">é€‰æ‹©ä¸€ç¯‡æ–‡ç« æŸ¥çœ‹è¯¦æƒ…</div>
          
          <div class="comment-input">
            <input type="text" id="commentInput" placeholder="å†™ä¸‹ä½ çš„è¯„è®º...">
            <button class="btn-primary" onclick="createComment()">å‘è¡¨</button>
          </div>
          
          <div id="commentList" style="margin-top: 15px;"></div>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šå“åº” -->
      <div class="panel">
        <h2>ğŸ“¤ API å“åº”</h2>
        <div id="response">æ¬¢è¿æ¥åˆ°åšå®¢ APIï¼

è¿™æ˜¯ä½ çš„ Node.js å­¦ä¹ æ¯•ä¸šé¡¹ç›®ã€‚

è¯¾ç¨‹å›é¡¾ï¼š
â”œâ”€â”€ ç¬¬1è¯¾ï¼šExpress åŸºç¡€
â”œâ”€â”€ ç¬¬2è¯¾ï¼šä¸­é—´ä»¶
â”œâ”€â”€ ç¬¬3è¯¾ï¼šMVC æ¶æ„
â”œâ”€â”€ ç¬¬4è¯¾ï¼šæ•°æ®éªŒè¯
â”œâ”€â”€ ç¬¬5è¯¾ï¼šæ•°æ®åº“
â”œâ”€â”€ ç¬¬6è¯¾ï¼šJWT è®¤è¯
â”œâ”€â”€ ç¬¬7è¯¾ï¼šæ–‡ä»¶ä¸Šä¼ 
â””â”€â”€ ç¬¬8è¯¾ï¼šé¡¹ç›®æ•´åˆ â† ä½ åœ¨è¿™é‡Œ

å¼€å§‹ä½“éªŒå§ï¼
1. æ³¨å†Œä¸€ä¸ªè´¦å·
2. å‘å¸ƒä¸€ç¯‡æ–‡ç« 
3. ç»™æ–‡ç« æ·»åŠ è¯„è®º</div>
      </div>
    </div>
  </div>
  
  <script>
    const API = 'http://localhost:3000/api';
    let token = localStorage.getItem('token');
    let currentUser = JSON.parse(localStorage.getItem('user') || 'null');
    let currentArticleId = null;
    
    updateStatus();
    loadArticles();
    
    function show(data) {
      document.getElementById('response').textContent = JSON.stringify(data, null, 2);
    }
    
    function updateStatus() {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');
      const name = document.getElementById('userName');
      
      if (token && currentUser) {
        dot.className = 'status-dot online';
        text.textContent = 'å·²ç™»å½•: ';
        name.textContent = currentUser.username;
      } else {
        dot.className = 'status-dot offline';
        text.textContent = 'æœªç™»å½•';
        name.textContent = '';
      }
    }
    
    function saveAuth(data) {
      token = data.token;
      currentUser = data.user;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(currentUser));
      updateStatus();
    }
    
    function logout() {
      token = null;
      currentUser = null;
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      updateStatus();
      show({ message: 'å·²é€€å‡ºç™»å½•' });
    }
    
    function getHeaders() {
      const headers = { 'Content-Type': 'application/json' };
      if (token) headers['Authorization'] = `Bearer ${token}`;
      return headers;
    }
    
    function switchAuthTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
      document.getElementById('registerForm').style.display = tab === 'register' ? 'block' : 'none';
    }
    
    async function login() {
      const res = await fetch(`${API}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: document.getElementById('loginEmail').value,
          password: document.getElementById('loginPassword').value
        })
      });
      const data = await res.json();
      show(data);
      if (res.ok) saveAuth(data);
    }
    
    async function register() {
      const res = await fetch(`${API}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('regUsername').value,
          email: document.getElementById('regEmail').value,
          password: document.getElementById('regPassword').value
        })
      });
      const data = await res.json();
      show(data);
      if (res.ok) saveAuth(data);
    }
    
    async function loadArticles() {
      const res = await fetch(`${API}/articles`);
      const data = await res.json();
      show(data);
      renderArticles(data.data || []);
    }
    
    async function loadMyArticles() {
      const res = await fetch(`${API}/articles/user/my`, { headers: getHeaders() });
      const data = await res.json();
      show(data);
      renderArticles(Array.isArray(data) ? data : []);
    }
    
    function renderArticles(articles) {
      const list = document.getElementById('articleList');
      if (!articles.length) {
        list.innerHTML = '<p style="color: #94a3b8;">æš‚æ— æ–‡ç« </p>';
        return;
      }
      
      list.innerHTML = articles.map(a => `
        <div class="article-card" onclick="loadArticle(${a.id})">
          <h3>${a.title} <span class="badge badge-${a.status}">${a.status}</span></h3>
          <p>${a.summary || a.content?.substring(0, 100) || ''}</p>
          <div class="meta">
            ğŸ‘¤ ${a.author?.username || 'åŒ¿å'} | ğŸ‘ ${a.view_count || 0} æµè§ˆ | 
            ğŸ“… ${new Date(a.created_at).toLocaleDateString()}
          </div>
        </div>
      `).join('');
    }
    
    async function loadArticle(id) {
      currentArticleId = id;
      const res = await fetch(`${API}/articles/${id}`, { headers: getHeaders() });
      const article = await res.json();
      show(article);
      
      document.getElementById('detailContent').innerHTML = `
        <h3 style="color: #60a5fa; margin-bottom: 10px;">${article.title}</h3>
        <div style="color: #94a3b8; font-size: 13px; margin-bottom: 15px;">
          ğŸ‘¤ ${article.author?.username || 'åŒ¿å'} | ğŸ‘ ${article.view_count} æµè§ˆ
        </div>
        <p style="line-height: 1.8;">${article.content}</p>
      `;
      
      renderComments(article.comments || []);
    }
    
    function renderComments(comments) {
      const list = document.getElementById('commentList');
      if (!comments.length) {
        list.innerHTML = '<p style="color: #94a3b8; font-size: 13px;">æš‚æ— è¯„è®º</p>';
        return;
      }
      
      list.innerHTML = comments.map(c => `
        <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; margin-bottom: 8px;">
          <strong style="color: #60a5fa;">${c.user?.username || 'åŒ¿å'}</strong>
          <span style="color: #6b7280; font-size: 12px; margin-left: 10px;">
            ${new Date(c.created_at).toLocaleString()}
          </span>
          <p style="margin-top: 5px; font-size: 14px;">${c.content}</p>
        </div>
      `).join('');
    }
    
    async function createArticle() {
      const res = await fetch(`${API}/articles`, {
        method: 'POST',
        headers: getHeaders(),
        body: JSON.stringify({
          title: document.getElementById('articleTitle').value,
          content: document.getElementById('articleContent').value,
          status: document.getElementById('articleStatus').value
        })
      });
      const data = await res.json();
      show(data);
      if (res.ok) {
        loadArticles();
        document.getElementById('articleTitle').value = '';
        document.getElementById('articleContent').value = '';
      }
    }
    
    async function createComment() {
      if (!currentArticleId) return alert('è¯·å…ˆé€‰æ‹©æ–‡ç« ');
      
      const content = document.getElementById('commentInput').value;
      if (!content) return alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹');
      
      const res = await fetch(`${API}/articles/${currentArticleId}/comments`, {
        method: 'POST',
        headers: getHeaders(),
        body: JSON.stringify({ content })
      });
      const data = await res.json();
      show(data);
      if (res.ok) {
        document.getElementById('commentInput').value = '';
        loadArticle(currentArticleId);
      }
    }
  </script>
</body>
</html>

